# 現時点でのまとめ

正規化することにより切り出されたテーブルが増えるが、

それによりテーブル結合の頻度も増え、参照系のクエリの実行速度が遅くなってしまう。

一方、正規化により、更新系クエリの実行時における登録データの不整合を防ぐことができると同時に、

更新されるレコード数も最小化される、といったメリットもある。

ただ、*参照系クエリの検索パフォーマンスの向上のために非正規化された状態に戻す*べきではない。

**それよりも他に出来ることはないか、最善を尽くすべき。**

非正規化に戻すのは**本当の最終手段**であり、**劇薬**である。

---

受注テーブルと受注明細テーブルがあったとして、受注明細テーブルにしか商品カラム(受注した商品に関するデータを扱うカラム)はないとする。

そして両テーブルとも*第三正規形*を満たしているとする。

上記の関係性におけるテーブルにて、テーブル結合により求めている結果を返す参照系クエリを実行することが最善策ではあるが、同時に受注明細テーブルはその性質上、

レコード数が膨大になるため、参照系クエリの実行速度がとても遅くなってしまう。

故に、受注テーブルにて「商品数カラム」を設けることにより、参照系クエリのパフォーマンス問題を解決する、というアイディアがあり、

この時、その商品数カラムのような性質を帯びたカラムおよびデータのことを**サマリーデータ**という。

そして、そのように構成することを**サマリーデータによる冗長構成**という。

ただサマリーデータを持たせたテーブル設計にしてしまうことにより、受注ID(主キー)以外にも*関数従属*が発生してしまうカラム(*推移的関数従属*)が存在してしまい、

**第三正規化されたテーブルを崩してしまうことにもなる。**

これは第三正規化だけの話ではなく、第二正規化されたテーブルにおいても次元を下げてしまうこと（*部分関数従属*が発生してしまう）もある...

その事例として、受注IDと受注明細連番の2つで主キーとする受注明細テーブルに「受注日カラム」を設けることが挙げられる。

このような構成を**選択条件における冗長構成**と言うが、このカラムを設けてしまうことにより、

主キーのどちらか一方だけでも関数従属が発生する部分関数従属が発生してしまい、第二正規化よりも正規化の次元が下がってしまう...

---

正規化する際には、参照系クエリのパフォーマンス問題を踏まえて**非正規化**(**正規化の次元を落とす**)のことも考慮に入れて設計をする必要があるが、

**これは非正規化を推奨している訳では無い。**

仮に非正規化によるテーブル設計を行うのなら、そのテーブルの該当カラムの更新処理がいつ、どのくらいの頻度で必要になるのか、

このあたりの業務要件を慎重に調査して、設計を行う必要がある。



